(function(j){function d(a,b,e){this._={missable:0,waits:a,state:f,pass:0,miss:0,args:[],tag:e||"",fn:b};e&&(c[e]=this);g(this)}function h(a,b,e,d){var c=a._;b?++c.pass:++c.miss;void 0!==e&&(c.args.push(e),d&&(c.args[d]=e));g(a)}function g(a){a=a._;a.state===f&&(a.state=a.miss>a.missable?"fail":a.pass+a.miss>=a.waits?"done":a.state);a.state!==f&&a.fn&&("done"===a.state?a.fn.pass?a.fn.pass():a.fn(null,a.args):a.fn.miss?a.fn.miss():a.fn(Error(a.state),a.args),a.fn=null,a.args=[],a.tag&&(c[a.tag]=null))}
d.name="Flow";d.dump=function(){var a=[],b;for(b in c)null==c[b]?delete c[b]:a.push(JSON.stringify(c[b]._,"",4));return a+""};d.prototype={constructor:d,missable:function(a){this._.missable+=a;return this},extend:function(a){this._.waits+=a;return this},pass:function(a,b){h(this,!0,a,b);return this},miss:function(a,b){h(this,!1,a,b);return this},exit:function(){this._.state===f&&(this._.state="exit");g(this)}};var f="progress",c={};"undefined"!==typeof module&&(module.exports={Flow:d});j.Flow=d})(this.self||global);
